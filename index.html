tg.sendData(JSON.stringify({
    customer:{name:name.value,phone:phone.value,address:addr.value},
    items,
    total: total.toFixed(2)
  }));

  cart = {};
  closeDrawer();
}

// ===== ADMIN =====
if (isAdmin) {
  const btn = document.createElement('button');
  btn.textContent = '‚öô –ê–¥–º–∏–Ω';
  btn.style = 'position:fixed;bottom:90px;right:20px;z-index:9999;';
  btn.onclick = openAdminPanel;
  document.body.appendChild(btn);
}

function openAdminPanel() {
  const d = document.createElement('div');
  d.style = 'position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:10000;';
  d.innerHTML = 
  <div style="background:#fff;margin:5%;padding:15px;border-radius:16px;">
    <h2>–ê–¥–º–∏–Ω</h2>
    <input id="a-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
    <input id="a-price" type="number" placeholder="–¶–µ–Ω–∞">
    <input id="a-img-url" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ">
    <input id="a-img-file" type="file">
    <button onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å</button>
    <hr>
    <div id="admin-list"></div>
    <button onclick="this.parentNode.parentNode.remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>;
  document.body.appendChild(d);
  renderAdminList();
}

function addProduct() {
  const name = document.getElementById('a-name').value;
  const price = +document.getElementById('a-price').value;
  const file = document.getElementById('a-img-file').files[0];
  const url = document.getElementById('a-img-url').value;

  if (file) {
    const r = new FileReader();
    r.onload = () => saveProduct(name, price, r.result);
    r.readAsDataURL(file);
  } else {
    saveProduct(name, price, url);
  }
}

function saveProduct(name, price, image) {
  products.push({
    id: Date.now(),
    price,
    image,
    ru:{n:name}
  });
  Storage.save();
  renderAdminList();
  renderProducts();
}

function renderAdminList() {
  const b = document.getElementById('admin-list');
  b.innerHTML = '';
  products.forEach((p,i)=>{
    b.innerHTML += 
    <div>
      <input value="${p.ru.n}" onchange="products[${i}].ru.n=this.value">
      <input type="number" value="${p.price}" onchange="products[${i}].price=+this.value">
      <input value="${p.image||''}" onchange="products[${i}].image=this.value">
      <button onclick="Storage.save();renderProducts()">üíæ</button>
      <button onclick="products.splice(${i},1);Storage.save();renderAdminList();renderProducts()">üóë</button>
    </div>;
  });
}
</script>

</body>
</html>
