<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gastro Gold V1.1.9</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&family=Unbounded:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg: #FFF9F5;
            --card-bg: #ffffff;
            --accent-red: #E63946;
            --accent-orange: #F3722C;
            --accent-yellow: #F9C74F;
            --text-main: #2D2424;
            --text-dim: #7D7474;
            --border: rgba(230, 57, 70, 0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Manrope', sans-serif;
            background: var(--bg);
            color: var(--text-main);
            margin: 0; padding: 0;
            overflow-x: hidden;
            -webkit-user-select: none;
            padding-bottom: 120px;
        }

        h1, h2, h3, .unbounded { font-family: 'Unbounded', sans-serif; }

        header {
            padding: 20px 20px 10px;
            position: sticky; top: 0;
            background: rgba(255, 249, 245, 0.85);
            backdrop-filter: blur(15px);
            z-index: 100;
            border-bottom: 1px solid var(--border);
        }

        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .logo { font-size: 22px; font-weight: 900; line-height: 0.9; color: var(--accent-red); }
        .logo span { color: var(--accent-orange); }
        .app-version { font-size: 9px; color: var(--text-dim); font-weight: 800; opacity: 0.6; margin-top: 4px; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .product-card { 
            animation: fadeIn 0.4s ease-out forwards;
            background: var(--card-bg); border-radius: 24px; padding: 12px;
            border: 1px solid var(--border); position: relative;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
            transition: transform 0.2s ease;
        }

        .ad-carousel {
            margin: 10px 16px 15px;
            border-radius: 22px;
            overflow: hidden;
            height: 150px;
            position: relative;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }
        .carousel-track { display: flex; height: 100%; width: 100%; position: relative; }
        .carousel-slide {
            position: absolute; inset: 0; opacity: 0;
            transition: opacity 0.8s ease-in-out;
            display: flex; align-items: center; justify-content: center;
        }
        .carousel-slide.active { opacity: 1; z-index: 10; }
        .carousel-slide img { width: 100%; height: 100%; object-fit: cover; }

        .categories { display: flex; gap: 8px; overflow-x: auto; padding: 15px 20px; scrollbar-width: none; }
        .categories::-webkit-scrollbar { display: none; }
        
        .cat-btn {
            padding: 10px 18px; border-radius: 12px; background: #fff;
            border: 1px solid var(--border); color: var(--text-dim);
            font-size: 12px; font-weight: 600; white-space: nowrap;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .cat-btn.active {
            background: linear-gradient(135deg, var(--accent-red) 0%, var(--accent-orange) 100%);
            color: #fff; transform: scale(1.05); 
            box-shadow: 0 10px 20px -5px rgba(230, 57, 70, 0.4);
            border-color: transparent;
        }

        .product-img { 
            width: 100%; aspect-ratio: 1; border-radius: 18px; object-fit: cover; margin-bottom: 10px;
            background: #f0f0f0; transition: transform 0.3s ease;
        }

        .badge {
            position: absolute; top: -6px; right: -6px;
            background: var(--accent-yellow); color: #000;
            font-size: 10px; font-weight: 900; padding: 3px 8px; border-radius: 8px; z-index: 5;
            box-shadow: 0 4px 10px rgba(249, 199, 79, 0.4);
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop { from { transform: scale(0); } to { transform: scale(1); } }

        .btn-icon {
            width: 32px; height: 32px; border-radius: 10px; border: none;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 18px; font-weight: bold;
            transition: transform 0.1s;
        }
        .btn-icon:active { transform: scale(0.9); }
        .add-btn { background: var(--accent-yellow); color: #000; }
        .remove-btn { background: #f3f3f3; color: var(--text-dim); }

        .cart-bar {
            position: fixed; bottom: 25px; left: 16px; right: 16px;
            background: #fff; border-radius: 24px;
            display: none; flex-direction: column; padding: 12px 10px 12px 20px;
            z-index: 1000;
            box-shadow: 0 15px 40px rgba(230, 57, 70, 0.15); border: 1px solid var(--border);
        }
        .cart-bar.active { display: flex; animation: drawerUp 0.3s ease-out; }

        .progress-container {
            width: 100%; height: 4px; background: #eee; border-radius: 2px;
            margin-bottom: 10px; overflow: hidden;
        }
        .progress-fill {
            height: 100%; background: var(--accent-orange);
            width: 0%; transition: width 0.4s ease;
        }

        .checkout-btn {
            background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
            color: #fff; height: 48px; padding: 0 25px; border-radius: 16px;
            border: none; font-family: 'Unbounded'; font-size: 12px; font-weight: 700;
            transition: all 0.3s ease;
        }
        .checkout-btn:disabled {
            background: #e0e0e0;
            color: #9e9e9e;
            transform: scale(1) !important;
            box-shadow: none;
        }

        #cart-drawer {
            position: fixed; inset: 0; 
            backdrop-filter: blur(20px);
            background: rgba(255, 249, 245, 0.98);
            z-index: 2000; display: none; flex-direction: column;
            animation: drawerUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes drawerUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .drawer-header { padding: 24px 24px 10px; flex-shrink: 0; }
        .drawer-content { 
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 0 24px;
            scroll-behavior: smooth;
        }
        .drawer-footer { 
            padding: 10px 24px 30px; 
            background: white; 
            border-top: 1px solid var(--border);
            box-shadow: 0 -10px 25px rgba(0,0,0,0.03);
            flex-shrink: 0;
        }

        .cash-only-badge {
            background: #FFF4E5;
            color: #D68910;
            font-size: 11px;
            font-weight: 800;
            padding: 8px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 12px;
            border: 1px dashed #D68910;
        }

        input.modern, textarea.modern {
            width: 100%; background: #FDFDFD; border: 1px solid var(--border);
            border-radius: 16px; padding: 14px; color: var(--text-main);
            margin-bottom: 10px; outline: none; font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Manrope', sans-serif;
        }
        textarea.modern { resize: none; min-height: 60px; }
        input.modern:focus, textarea.modern:focus { border-color: var(--accent-orange); background: #fff; }

        input.error {
            border-color: var(--accent-red) !important;
            background: #fffafa !important;
            animation: shake 0.3s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .min-sum-hint {
            font-size: 9px;
            font-weight: 800;
            color: var(--accent-red);
            text-transform: uppercase;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–ª–µ—Ç–∞ —Ç–æ–≤–∞—Ä–∞ */
        .fly-item {
            position: fixed; width: 50px; height: 50px; border-radius: 50%;
            background: var(--accent-yellow); z-index: 3000; pointer-events: none;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-size: 20px; transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);
        }
    </style>
</head>
<body onload="init()">

<header>
    <div class="top-bar">
        <div>
            <div class="logo">GASTRO<br><span>GOLD</span></div>
            <div class="app-version">BUILD V1.1.9</div>
        </div>
        <div style="display: flex; gap: 5px; background: rgba(230, 57, 70, 0.05); padding: 4px; border-radius: 14px;">
            <button class="cat-btn" id="lang-ru" onclick="changeLang('ru')">RU</button>
            <button class="cat-btn" id="lang-az" onclick="changeLang('az')">AZ</button>
        </div>
    </div>
</header>

<div class="ad-carousel" id="main-carousel">
    <div class="carousel-track" id="carousel-track"></div>
</div>

<div class="categories" id="cat-scroll"></div>

<div class="content p-4">
    <div class="grid grid-cols-2 gap-3" id="product-grid"></div>
</div>

<!-- –ü–∞–Ω–µ–ª—å –∫–æ—Ä–∑–∏–Ω—ã —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º -->
<div class="cart-bar" id="cart-bar">
    <div id="min-sum-progress-container" class="progress-container">
        <div id="min-sum-progress-fill" class="progress-fill"></div>
    </div>
    <div class="flex justify-between items-center w-full">
        <div class="cart-info" onclick="openDrawer()" style="cursor: pointer;">
            <span id="txt-items-count" style="font-size: 10px; font-weight: 800; color: var(--text-dim);">0 –¢–û–í–ê–†–û–í</span><br>
            <b id="txt-total-price" style="color: var(--accent-red);">0.00 ‚Çº</b>
            <div id="min-sum-msg" class="min-sum-hint"></div>
        </div>
        <button class="checkout-btn" id="btn-checkout-main" onclick="openDrawer()">–û–§–û–†–ú–ò–¢–¨</button>
    </div>
</div>

<div id="cart-drawer">
    <div class="drawer-header flex justify-between items-center">
        <h2 class="unbounded text-lg" id="txt-cart-title">–ö–û–†–ó–ò–ù–ê</h2>
        <button onclick="closeDrawer()" class="bg-white w-10 h-10 rounded-full border border-[var(--border)] shadow-sm flex items-center justify-center">‚úï</button>
    </div>
    
    <div class="drawer-content" id="drawer-scroll-area">
        <div id="drawer-items" class="space-y-2 py-2"></div>
        
        <div class="mt-8 mb-4 p-4 bg-orange-50 rounded-2xl border border-orange-100" id="delivery-form-section">
            <div class="flex justify-between items-center mb-4">
                <h3 class="unbounded text-[11px] text-orange-800 uppercase tracking-widest flex items-center gap-2">
                    üìç <span id="txt-form-title">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–ª—è –∑–∞–∫–∞–∑–∞</span>
                </h3>
            </div>
            <div class="form-group">
                <input type="text" class="modern" id="f-name" placeholder="–ò–º—è">
                <input type="tel" class="modern" id="f-phone" placeholder="+994 (__) ___-__-__" maxlength="19">
                <input type="text" class="modern" id="f-addr" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏">
                <textarea class="modern" id="f-comment" placeholder="–î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫ –∑–∞–∫–∞–∑—É..."></textarea>
            </div>
        </div>
    </div>

    <div class="drawer-footer">
        <div class="cash-only-badge" id="txt-cash-info">
            üíµ –û–ü–õ–ê–¢–ê –¢–û–õ–¨–ö–û –ù–ê–õ–ò–ß–ù–´–ú–ò
        </div>
        <div class="flex justify-between items-center mb-4 px-1">
            <span class="text-xs font-bold text-[var(--text-dim)]" id="txt-footer-total-label">–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï:</span>
            <span class="unbounded text-lg font-black text-[var(--accent-red)]" id="txt-footer-total-val">0.00 ‚Çº</span>
        </div>
        <button class="checkout-btn w-full !h-[60px] uppercase tracking-widest shadow-lg" id="confirm-btn" onclick="submitOrder()">–ü–û–î–¢–í–ï–†–î–ò–¢–¨</button>
    </div>
</div>

<script>
    const MIN_ORDER_SUM = 5.50;

    let products = [
        { id: '1', cat: 'burger', price: 14.5, icon: 'üçî', img: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=400', ru: {n: "–ì–æ–ª–¥ –ë—É—Ä–≥–µ—Ä", d: "–ú—è—Å–æ –ø—Ä–∞–π–º, —á–µ–¥–¥–µ—Ä"}, az: {n: "Gold Burqer", d: "Praym …ôt, √ßedder"} },
        { id: '2', cat: 'burger', price: 12.0, icon: 'üçî', img: 'https://images.unsplash.com/photo-1550547660-d9450f859349?w=400', ru: {n: "–ß–∏–∫–µ–Ω –õ—é–∫—Å", d: "–ö—É—Ä–∏—Ü–∞ –≥—Ä–∏–ª—å"}, az: {n: "√áiken L√ºks", d: "Toyuq qril"} },
        { id: '3', cat: 'pizza', price: 18.0, icon: 'üçï', img: 'https://images.unsplash.com/photo-1513104890138-7c749659a591?w=400', ru: {n: "–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞", d: "–¢–æ–º–∞—Ç—ã, –º–æ—Ü–∞—Ä–µ–ª–ª–∞"}, az: {n: "Marqarita", d: "Pomidor, mosarella"} },
        { id: '4', cat: 'pizza', price: 21.0, icon: 'üçï', img: 'https://images.unsplash.com/photo-1574126154517-d1e0d89ef734?w=400', ru: {n: "–ü–µ–ø–ø–µ—Ä–æ–Ω–∏", d: "–û—Å—Ç—Ä–∞—è —Å–∞–ª—è–º–∏"}, az: {n: "Pepperoni", d: "Acƒ±lƒ± salyami"} },
        { id: '5', cat: 'sides', price: 5.5, icon: 'üçü', img: 'https://images.unsplash.com/photo-1573015613135-a419014b2c49?w=400', ru: {n: "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –§—Ä–∏", d: "–ö—Ä—É–ø–Ω–∞—è —Å–æ–ª—å, —Å–æ—É—Å"}, az: {n: "Kartof Fri", d: "ƒ∞ri duz, sous"} },
        { id: '6', cat: 'sides', price: 6.0, icon: 'üçó', img: 'https://images.unsplash.com/photo-1541581340-374c644bcd42?w=400', ru: {n: "–ù–∞–≥–≥–µ—Ç—Å—ã", d: "6 —à—Ç—É–∫, –ø–∞–Ω–∏—Ä–æ–≤–∫–∞"}, az: {n: "Naggetsl…ôr", d: "6 …ôd…ôd, suxarƒ±"} },
        { id: '7', cat: 'drinks', price: 2.5, icon: 'ü•§', img: 'https://images.unsplash.com/photo-1622483767028-3f66f32aef97?w=400', ru: {n: "Coca-Cola", d: "0.5–ª —Ö–æ–ª–æ–¥–Ω–∞—è"}, az: {n: "Coca-Cola", d: "0.5l soyuq"} },
        { id: '8', cat: 'drinks', price: 2.5, icon: 'ü•§', img: 'https://images.unsplash.com/photo-1625772299848-391b6a87d7b3?w=400', ru: {n: "Fanta", d: "0.5–ª —Ö–æ–ª–æ–¥–Ω–∞—è"}, az: {n: "Fanta", d: "0.5l soyuq"} },
        { id: '9', cat: 'burger', price: 16.0, icon: 'üçî', img: 'https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?w=400', ru: {n: "–î–∞–±–ª –ß–∏–∑", d: "–î–≤–æ–π–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞"}, az: {n: "Dabl √áiz", d: "ƒ∞kiqat kotlet"} },
        { id: '10', cat: 'pizza', price: 19.5, icon: 'üçï', img: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=400', ru: {n: "–ß–µ—Ç—ã—Ä–µ –°—ã—Ä–∞", d: "–ü–∞—Ä–º–µ–∑–∞–Ω, –î–æ—Ä –±–ª—é"}, az: {n: "D√∂rd Pendir", d: "Parmezan, Dor bl√º"} },
        { id: '11', cat: 'burger', price: 15.0, icon: 'üçî', img: 'https://images.unsplash.com/photo-1586190848861-99aa4a171e90?w=400', ru: {n: "BBQ –ë—É—Ä–≥–µ—Ä", d: "–ë–µ–∫–æ–Ω, —Å–æ—É—Å BBQ"}, az: {n: "BBQ Burqer", d: "Bikon, BBQ sousu"} },
        { id: '12', cat: 'burger', price: 13.5, icon: 'üçî', img: 'https://images.unsplash.com/photo-1521305916504-4a1121188589?w=400', ru: {n: "–•–∞–ª–∞–ø–µ–Ω—å–æ –ë—É—Ä–≥–µ—Ä", d: "–û—Å—Ç—Ä—ã–π –ø–µ—Ä—á–∏–∫"}, az: {n: "Xalapeno Burqer", d: "Acƒ± bib…ôr"} },
        { id: '13', cat: 'pizza', price: 22.0, icon: 'üçï', img: 'https://images.unsplash.com/photo-1593504049359-74330189a355?w=400', ru: {n: "–ì—Ä–∏–±–Ω–∞—è –ü–∏—Ü—Ü–∞", d: "–®–∞–º–ø–∏–Ω—å–æ–Ω—ã, —Å–æ—É—Å"}, az: {n: "G√∂b…ôl…ôkli Pizza", d: "≈ûampinyon, sous"} },
        { id: '14', cat: 'pizza', price: 20.0, icon: 'üçï', img: 'https://images.unsplash.com/photo-1565299585323-38d6b0865b47?w=400', ru: {n: "–ì–∞–≤–∞–π—Å–∫–∞—è", d: "–ê–Ω–∞–Ω–∞—Å—ã, –∫—É—Ä–∏—Ü–∞"}, az: {n: "Havay Pizzasƒ±", d: "Ananas, toyuq"} },
        { id: '15', cat: 'sides', price: 8.5, icon: 'üçó', img: 'https://images.unsplash.com/photo-1562967914-608f82629710?w=400', ru: {n: "–ö—Ä—ã–ª—ã—à–∫–∏", d: "–û—Å—Ç—Ä—ã–µ –±–∞—Ñ—Ñ–∞–ª–æ"}, az: {n: "Toyuq Qanadlarƒ±", d: "Acƒ±lƒ± baffalo"} },
        { id: '16', cat: 'sides', price: 4.0, icon: 'üßÖ', img: 'https://images.unsplash.com/photo-1630384066255-4427b59ba5a4?w=400', ru: {n: "–õ—É–∫–æ–≤—ã–µ –∫–æ–ª—å—Ü–∞", d: "–í —Ö—Ä—É—Å—Ç—è—â–µ–π –ø–∞–Ω–∏—Ä–æ–≤–∫–µ"}, az: {n: "Soƒüan halqalarƒ±", d: "Xƒ±rtƒ±ldayan suxarƒ±"} },
        { id: '17', cat: 'drinks', price: 3.5, icon: 'üçä', img: 'https://images.unsplash.com/photo-1513558161293-cdaf765ed2fd?w=400', ru: {n: "–ê–ø–µ–ª—å—Å–∏–Ω. —Å–æ–∫", d: "0.4–ª —Å–≤–µ–∂–µ–≤—ã–∂–∞—Ç—ã–π"}, az: {n: "Portaqal ≈üir…ôsi", d: "0.4l t…ôz…ô"} },
        { id: '18', cat: 'drinks', price: 2.0, icon: 'üíß', img: 'https://images.unsplash.com/photo-1544145945-f904253d0c71?w=400', ru: {n: "–í–æ–¥–∞", d: "–ë–µ–∑ –≥–∞–∑–∞ 0.5–ª"}, az: {n: "Su", d: "Qazsƒ±n 0.5l"} },
        { id: '19', cat: 'burger', price: 11.5, icon: 'üçî', img: 'https://images.unsplash.com/photo-1513185158878-8d8c182b013f?w=400', ru: {n: "–ú–∏–Ω–∏ –ë—É—Ä–≥–µ—Ä", d: "–î–ª—è –ª–µ–≥–∫–æ–≥–æ –ø–µ—Ä–µ–∫—É—Å–∞"}, az: {n: "Mini Burqer", d: "Y√ºng√ºl q…ôlyanaltƒ±"} },
        { id: '20', cat: 'pizza', price: 25.0, icon: 'üçï', img: 'https://images.unsplash.com/photo-1571407970349-bc81e7e96d47?w=400', ru: {n: "–ú—è—Å–Ω–∞—è –ü–∏—Ü—Ü–∞", d: "–ê—Å—Å–æ—Ä—Ç–∏ –∏–∑ 4 –≤–∏–¥–æ–≤ –º—è—Å–∞"}, az: {n: "∆ètli Pizza", d: "4 n√∂v …ô—Ç assorti"} }
    ];

    const ads = [
        { id: 'a1', img: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800' },
        { id: 'a2', img: 'https://images.unsplash.com/photo-1543353071-10c8ba85a904?w=800' }
    ];

    let cart = {};
    let lang = 'ru';
    let activeCat = 'all';
    const tg = window.Telegram.WebApp;

    const i18n = {
        ru: { items: "–¢–û–í–ê–†–û–í", cart: "–ö–û–†–ó–ò–ù–ê", confirm: "–ü–û–î–¢–í–ï–†–î–ò–¢–¨", checkout: "–û–§–û–†–ú–ò–¢–¨", addr: "–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏", name: "–ò–º—è", comment: "–î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫ –∑–∞–∫–∞–∑—É...", totalLabel: "–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï:", cash: "üíµ –û–ü–õ–ê–¢–ê –¢–û–õ–¨–ö–û –ù–ê–õ–ò–ß–ù–´–ú–ò", formTitle: "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–ª—è –∑–∞–∫–∞–∑–∞", minSum: "–ú–∏–Ω–∏–º—É–º 5.50 ‚Çº", more: "–î–æ–±–∞–≤—å—Ç–µ –µ—â–µ" },
        az: { items: "M∆èHSUL", cart: "S∆èB∆èT", confirm: "T∆èSDƒ∞QL∆è", checkout: "Sƒ∞FARƒ∞≈û ET", addr: "√áatdƒ±rƒ±lma √ºnvanƒ±", name: "Ad", comment: "Sifari≈ü √º√ß√ºn …ôlav…ôl…ôr...", totalLabel: "C∆èMƒ∞ √ñD∆èNƒ∞≈û:", cash: "üíµ ANCAQ NAƒûD √ñD∆èNƒ∞≈û", formTitle: "Sifari≈ü √º√ß√ºn doldurun", minSum: "Minimum 5.50 ‚Çº", more: "∆èlav…ô edin" }
    };

    function init() {
        renderCarousel();
        renderCategories();
        renderProducts();
        setupPhoneMask();
        updateLangUI();
        tg.ready();
        tg.expand();
        if (tg.initDataUnsafe?.user) {
            document.getElementById('f-name').value = tg.initDataUnsafe.user.first_name || "";
        }
    }

    function renderCarousel() {
        const track = document.getElementById('carousel-track');
        track.innerHTML = ads.map((ad, i) => `<div class="carousel-slide ${i === 0 ? 'active' : ''}"><img src="${ad.img}"></div>`).join('');
        let current = 0;
        setInterval(() => {
            const slides = document.querySelectorAll('.carousel-slide');
            if(slides.length === 0) return;
            slides[current].classList.remove('active');
            current = (current + 1) % slides.length;
            slides[current].classList.add('active');
        }, 4000);
    }

    function setupPhoneMask() {
        document.getElementById('f-phone').addEventListener('input', (e) => {
            let x = e.target.value.replace(/\D/g, '').match(/(\d{0,3})(\d{0,2})(\d{0,3})(\d{0,2})(\d{0,2})/);
            if (!x[1]) { e.target.value = '+994'; return; }
            e.target.value = `+994 (${x[2] || ''}) ${x[3] || ''}-${x[4] || ''}-${x[5] || ''}`.replace(/-+$/, '').replace(/\( \)/, '');
        });
    }

    function renderCategories() {
        const cats = lang === 'ru' ? 
            { all: "üçΩÔ∏è –í—Å–µ", burger: "üçî –ë—É—Ä–≥–µ—Ä—ã", pizza: "üçï –ü–∏—Ü—Ü–∞", sides: "üçü –ó–∞–∫—É—Å–∫–∏", drinks: "ü•§ –ù–∞–ø–∏—Ç–∫–∏" } : 
            { all: "üçΩÔ∏è Hamƒ±sƒ±", burger: "üçî Burqer", pizza: "üçï Pizza", sides: "üçü Q…ôlyanaltƒ±", drinks: "ü•§ ƒ∞√ßkil…ôr" };
        document.getElementById('cat-scroll').innerHTML = Object.keys(cats).map(k => `
            <button class="cat-btn ${activeCat === k ? 'active' : ''}" onclick="setCat('${k}')">${cats[k]}</button>
        `).join('');
    }

    window.setCat = (k) => { 
        activeCat = k; 
        renderCategories(); 
        renderProducts(); 
        tg.HapticFeedback.impactOccurred('light');
    };

    function renderProducts() {
        const grid = document.getElementById('product-grid');
        grid.innerHTML = products.filter(p => activeCat === 'all' || p.cat === activeCat).map(p => {
            const count = cart[p.id] || 0;
            return `
                <div class="product-card" id="card-${p.id}">
                    ${count > 0 ? `<div class="badge">${count}</div>` : ''}
                    <img src="${p.img}" class="product-img" loading="lazy">
                    <h3 class="unbounded text-[13px] font-extrabold mb-1 h-8 overflow-hidden">${p[lang].n}</h3>
                    <p class="text-[10px] text-[var(--text-dim)] mb-2 h-7 overflow-hidden">${p[lang].d}</p>
                    <div class="flex justify-between items-center">
                        <div class="text-[var(--accent-red)] font-black">${p.price.toFixed(2)} ‚Çº</div>
                        <div class="flex items-center gap-1">
                            ${count > 0 ? `
                                <button class="remove-btn btn-icon !w-7 !h-7 !text-sm" onclick="updateCount('${p.id}',-1, event)">-</button>
                            ` : ''}
                            <button class="add-btn btn-icon !w-7 !h-7 !text-sm" onclick="updateCount('${p.id}',1, event)">+</button>
                        </div>
                    </div>
                </div>`;
        }).join('');
    }

    window.updateCount = (id, delta, event) => {
        cart[id] = (cart[id] || 0) + delta;
        if (cart[id] <= 0) delete cart[id];
        
        tg.HapticFeedback.impactOccurred('light');
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–ª–µ—Ç–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏
        if (delta > 0 && event) {
            animateFlyItem(id, event.clientX, event.clientY);
        }

        renderProducts();
        updateCartBar();
        
        if (document.getElementById('cart-drawer').style.display === 'flex') {
            refreshDrawer();
        }
    };

    function animateFlyItem(id, startX, startY) {
        const p = products.find(x => x.id == id);
        const flyer = document.createElement('div');
        flyer.className = 'fly-item';
        flyer.innerText = p.icon || 'ü•°';
        flyer.style.left = startX + 'px';
        flyer.style.top = startY + 'px';
        document.body.appendChild(flyer);

        const target = document.getElementById('cart-bar').getBoundingClientRect();
        
        setTimeout(() => {
            flyer.style.left = (target.left + 30) + 'px';
            flyer.style.top = (target.top + 20) + 'px';
            flyer.style.transform = 'scale(0.2)';
            flyer.style.opacity = '0';
        }, 50);

        setTimeout(() => flyer.remove(), 700);
    }

    function updateCartBar() {
        const itemsCount = Object.values(cart).reduce((a,b) => a+b, 0);
        let total = 0;
        Object.keys(cart).forEach(id => { 
            const p = products.find(x => x.id == id);
            if (p) total += p.price * cart[id]; 
        });
        
        const isMinMet = total >= MIN_ORDER_SUM;
        const btnMain = document.getElementById('btn-checkout-main');
        const btnConfirm = document.getElementById('confirm-btn');
        const minMsg = document.getElementById('min-sum-msg');
        const fill = document.getElementById('min-sum-progress-fill');

        document.getElementById('cart-bar').classList.toggle('active', itemsCount > 0);
        document.getElementById('txt-items-count').innerText = `${itemsCount} ${i18n[lang].items}`;
        document.getElementById('txt-total-price').innerText = `${total.toFixed(2)} ‚Çº`;
        document.getElementById('txt-footer-total-val').innerText = `${total.toFixed(2)} ‚Çº`;

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º
        const percent = Math.min((total / MIN_ORDER_SUM) * 100, 100);
        fill.style.width = percent + '%';
        fill.style.backgroundColor = percent === 100 ? '#4CAF50' : '#F3722C';

        if (isMinMet) {
            btnMain.innerText = i18n[lang].checkout;
            btnConfirm.innerText = i18n[lang].confirm;
            btnMain.disabled = false;
            btnConfirm.disabled = false;
            minMsg.innerText = "‚úÖ " + (lang === 'ru' ? "–ú–∏–Ω–∏–º—É–º –¥–æ—Å—Ç–∏–≥–Ω—É—Ç" : "Minimum tamamlandƒ±");
            minMsg.style.color = "#4CAF50";
        } else {
            const diff = (MIN_ORDER_SUM - total).toFixed(2);
            btnMain.innerText = i18n[lang].minSum;
            btnConfirm.innerText = i18n[lang].minSum;
            btnMain.disabled = true;
            btnConfirm.disabled = true;
            minMsg.innerText = `${i18n[lang].more} ${diff} ‚Çº`;
            minMsg.style.color = "var(--accent-red)";
        }
    }

    function refreshDrawer() {
        const itemsList = Object.keys(cart);
        const container = document.getElementById('drawer-items');
        
        if(itemsList.length === 0) { 
            closeDrawer(); 
            return; 
        }
        
        container.innerHTML = itemsList.map(id => {
            const p = products.find(x => x.id == id);
            return `
            <div class="flex items-center bg-white p-3 rounded-2xl border border-[var(--border)] shadow-sm">
                <div class="w-10 h-10 flex items-center justify-center bg-gray-50 rounded-lg mr-3 text-xl">${p.icon}</div>
                <div class="flex-1 font-bold text-xs">${p[lang].n}</div>
                <div class="flex items-center gap-3">
                    <button class="remove-btn btn-icon !w-7 !h-7 !text-sm" onclick="updateCount('${id}',-1, event)">-</button>
                    <span class="font-bold text-sm min-w-[20px] text-center">${cart[id]}</span>
                    <button class="add-btn btn-icon !w-7 !h-7 !text-sm" onclick="updateCount('${id}',1, event)">+</button>
                </div>
            </div>`;
        }).join('');
    }

    window.openDrawer = () => {
        document.getElementById('cart-drawer').style.display = 'flex';
        refreshDrawer();
        tg.HapticFeedback.notificationOccurred('success');
    };

    window.closeDrawer = () => {
        document.getElementById('cart-drawer').style.display = 'none';
    };

    window.changeLang = (newLang) => {
        lang = newLang;
        renderCategories();
        renderProducts();
        updateLangUI();
        tg.HapticFeedback.selectionChanged();
    };

    function updateLangUI() {
        document.querySelectorAll('.top-bar .cat-btn').forEach(b => b.classList.remove('active'));
        const activeLangBtn = document.getElementById('lang-' + lang);
        if (activeLangBtn) activeLangBtn.classList.add('active');

        document.getElementById('txt-cart-title').innerText = i18n[lang].cart;
        document.getElementById('txt-footer-total-label').innerText = i18n[lang].totalLabel;
        document.getElementById('txt-cash-info').innerText = i18n[lang].cash;
        document.getElementById('txt-form-title').innerText = i18n[lang].formTitle;
        
        document.getElementById('f-name').placeholder = i18n[lang].name;
        document.getElementById('f-addr').placeholder = i18n[lang].addr;
        document.getElementById('f-comment').placeholder = i18n[lang].comment;
        
        updateCartBar();
    }

    window.submitOrder = () => {
        let total = 0;
        Object.keys(cart).forEach(id => { total += products.find(x => x.id == id).price * cart[id]; });
        if (total < MIN_ORDER_SUM) return;

        const name = document.getElementById('f-name');
        const phone = document.getElementById('f-phone');
        const addr = document.getElementById('f-addr');
        const comment = document.getElementById('f-comment').value;

        let hasError = false;
        [name, phone, addr].forEach(el => {
            if (el.value.length < 3) {
                el.classList.add('error');
                setTimeout(() => el.classList.remove('error'), 500);
                hasError = true;
            }
        });

        if (hasError) {
            tg.HapticFeedback.notificationOccurred('error');
            document.getElementById('delivery-form-section').scrollIntoView({ behavior: 'smooth', block: 'center' });
            return;
        }

        const orderItems = Object.keys(cart).map(id => {
            const p = products.find(x => x.id == id);
            return {
                name: p[lang].n,
                count: cart[id],
                price: p.price
            };
        });

        const orderData = {
            user: name.value,
            phone: phone.value,
            address: addr.value,
            comment: comment,
            items: orderItems,
            total: total.toFixed(2),
            payment: "CASH"
        };

        tg.sendData(JSON.stringify(orderData));
        tg.close();
    };
</script>

</body>
</html>

