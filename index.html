<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gastro Gold V1.2.6</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&family=Unbounded:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg: #FFF9F5;
            --card-bg: #ffffff;
            --accent-red: #E63946;
            --accent-orange: #F3722C;
            --accent-yellow: #F9C74F;
            --text-main: #2D2424;
            --text-dim: #7D7474;
            --border: rgba(230, 57, 70, 0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none !important; }
        
        body {
            font-family: 'Manrope', sans-serif;
            background: var(--bg);
            color: var(--text-main);
            margin: 0; padding: 0;
            overflow-x: hidden;
            -webkit-user-select: none;
            padding-bottom: 140px;
            /* –£—á–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–æ–Ω—ã iPhone */
            padding-bottom: calc(140px + env(safe-area-inset-bottom));
        }

        h1, h2, h3, .unbounded { font-family: 'Unbounded', sans-serif; }

        header {
            padding: 20px 20px 10px;
            position: sticky; top: 0;
            background: rgba(255, 249, 245, 0.85);
            backdrop-filter: blur(15px);
            z-index: 100;
            border-bottom: 1px solid var(--border);
        }

        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .logo { font-size: 22px; font-weight: 900; line-height: 0.9; color: var(--accent-red); }
        .logo span { color: var(--accent-orange); }
        .app-version { font-size: 9px; color: var(--text-dim); font-weight: 800; opacity: 0.6; margin-top: 4px; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .product-card { 
            animation: fadeIn 0.4s ease-out forwards;
            background: var(--card-bg); border-radius: 24px; padding: 12px;
            border: 1px solid var(--border); position: relative;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .product-card:active { transform: scale(0.95); }

        .ad-carousel {
            margin: 10px 16px 15px;
            border-radius: 22px;
            overflow: hidden;
            height: 150px;
            position: relative;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }
        .carousel-track { display: flex; height: 100%; width: 100%; position: relative; }
        .carousel-slide {
            position: absolute; inset: 0; opacity: 0;
            transition: opacity 0.8s ease-in-out;
            display: flex; align-items: center; justify-content: center;
        }
        .carousel-slide.active { opacity: 1; z-index: 10; }
        .carousel-slide img { width: 100%; height: 100%; object-fit: cover; }

        .categories { display: flex; gap: 8px; overflow-x: auto; padding: 15px 20px; scroll-behavior: smooth; }
        .categories::-webkit-scrollbar { display: none; }
        
        .cat-btn {
            padding: 10px 18px; border-radius: 12px; background: #fff;
            border: 1px solid var(--border); color: var(--text-dim);
            font-size: 12px; font-weight: 600; white-space: nowrap;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .cat-btn.active {
            background: linear-gradient(135deg, var(--accent-red) 0%, var(--accent-orange) 100%);
            color: #fff; transform: scale(1.05); 
            box-shadow: 0 10px 20px -5px rgba(230, 57, 70, 0.4);
            border-color: transparent;
        }

        .product-img { 
            width: 100%; aspect-ratio: 1; border-radius: 18px; object-fit: cover; margin-bottom: 10px;
            background: #f0f0f0; transition: transform 0.5s ease;
        }

        #product-modal {
            position: fixed; inset: 0; z-index: 3000;
            background: rgba(0,0,0,0.4); backdrop-filter: blur(8px);
            display: none; align-items: flex-end;
        }
        .modal-content {
            background: #fff; width: 100%; border-radius: 32px 32px 0 0;
            padding: 20px; 
            max-height: 85vh; 
            display: flex;
            flex-direction: column;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #modal-img {
            width: 100%; 
            max-height: 35vh; 
            object-fit: cover; 
            border-radius: 24px; 
            margin-bottom: 16px;
            flex-shrink: 1; 
        }
        .modal-info {
            flex-grow: 1;
            overflow-y: auto; 
            margin-bottom: 20px;
        }

        .badge {
            position: absolute; top: -6px; right: -6px;
            background: var(--accent-yellow); color: #000;
            font-size: 10px; font-weight: 900; padding: 3px 8px; border-radius: 8px; z-index: 5;
            box-shadow: 0 4px 10px rgba(249, 199, 79, 0.4);
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop { from { transform: scale(0); } to { transform: scale(1); } }

        .btn-icon {
            width: 32px; height: 32px; border-radius: 10px; border: none;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 18px; font-weight: bold;
            transition: transform 0.1s;
        }
        .btn-icon:active { transform: scale(0.9); }
        .add-btn { background: var(--accent-yellow); color: #000; }

        .cart-bar {
            position: fixed; bottom: 25px; left: 16px; right: 16px;
            background: #fff; border-radius: 24px;
            display: none; flex-direction: column; padding: 12px 10px 12px 20px;
            z-index: 1000;
            box-shadow: 0 15px 40px rgba(230, 57, 70, 0.15); border: 1px solid var(--border);
            padding-bottom: calc(12px + env(safe-area-inset-bottom) / 2);
        }
        .cart-bar.active { display: flex; animation: drawerUp 0.3s ease-out; }

        .progress-container {
            width: 100%; height: 4px; background: #eee; border-radius: 2px;
            margin-bottom: 10px; overflow: hidden;
        }
        .progress-fill {
            height: 100%; background: var(--accent-orange);
            width: 0%; transition: width 0.4s ease;
        }

        .checkout-btn {
            background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
            color: #fff; height: 48px; padding: 0 25px; border-radius: 16px;
            border: none; font-family: 'Unbounded'; font-size: 12px; font-weight: 700;
            transition: all 0.3s ease;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .checkout-btn:disabled {
            background: #e0e0e0 !important;
            color: #9e9e9e !important;
            transform: scale(1) !important;
            box-shadow: none !important;
            opacity: 0.7;
        }

        #cart-drawer {
            position: fixed; inset: 0; 
            backdrop-filter: blur(20px);
            background: rgba(255, 249, 245, 0.98);
            z-index: 2000; display: none; flex-direction: column;
            animation: drawerUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes drawerUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .drawer-header { padding: 24px 24px 10px; flex-shrink: 0; }
        .drawer-content { 
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 0 24px;
            scroll-behavior: smooth;
        }
        .drawer-footer { 
            padding: 10px 24px 30px; 
            background: white; 
            border-top: 1px solid var(--border);
            box-shadow: 0 -10px 25px rgba(0,0,0,0.03);
            flex-shrink: 0;
            padding-bottom: calc(30px + env(safe-area-inset-bottom));
        }

        .upsell-card {
            min-width: 120px; background: #fff; border-radius: 20px; padding: 12px;
            border: 1px solid var(--border); text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            transition: all 0.2s ease;
        }
        .upsell-card:active { transform: scale(0.95); background: #fdfdfd; }

        .cash-only-badge {
            background: #FFF4E5; color: #D68910; font-size: 11px; font-weight: 800;
            padding: 8px; border-radius: 12px; text-align: center; margin-bottom: 12px;
            border: 1px dashed #D68910;
        }

        input.modern, textarea.modern {
            width: 100%; background: #FDFDFD; border: 1px solid var(--border);
            border-radius: 16px; padding: 14px; color: var(--text-main);
            margin-bottom: 10px; outline: none; font-size: 14px;
            transition: all 0.3s ease; font-family: 'Manrope', sans-serif;
        }
        textarea.modern { resize: none; min-height: 60px; }
        input.modern:focus, textarea.modern:focus { border-color: var(--accent-orange); background: #fff; }
        
        input.modern.highlight { border: 2px solid var(--accent-red); background: #FFF5F5; animation: shake 0.4s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .min-sum-hint {
            font-size: 9px; font-weight: 800; color: var(--accent-red); text-transform: uppercase;
        }

        .fly-item {
            position: fixed; width: 40px; height: 40px; border-radius: 50%;
            background: var(--accent-yellow); z-index: 5000; pointer-events: none;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2); transition: 0.6s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .scroll-down-hint {
            text-align: center; color: var(--accent-orange); font-size: 10px; font-weight: 800;
            padding: 15px; background: rgba(243, 114, 44, 0.05); border-radius: 15px; margin: 15px 0;
            display: none; align-items: center; justify-content: center; gap: 8px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body onload="init()">

<header>
    <div class="top-bar">
        <div>
            <div class="logo">GASTRO<br><span>GOLD</span></div>
            <div class="app-version">BUILD V1.2.6</div>
        </div>
        <div style="display: flex; gap: 5px; background: rgba(230, 57, 70, 0.05); padding: 4px; border-radius: 14px;">
            <button class="cat-btn" id="lang-ru" onclick="changeLang('ru')">RU</button>
            <button class="cat-btn" id="lang-az" onclick="changeLang('az')">AZ</button>
        </div>
    </div>
</header>

<div class="ad-carousel" id="main-carousel">
    <div class="carousel-track" id="carousel-track"></div>
</div>

<div class="categories no-scrollbar" id="cat-scroll"></div>

<div class="content p-4">
    <div class="grid grid-cols-2 gap-3" id="product-grid"></div>
</div>

<div id="product-modal" onclick="closeProductModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="w-12 h-1 bg-gray-200 rounded-full mx-auto mb-4 flex-shrink-0"></div>
        <img id="modal-img" src="" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
        
        <div class="modal-info">
            <div class="flex justify-between items-start mb-2">
                <h2 id="modal-title" class="unbounded text-lg uppercase leading-tight"></h2>
                <span id="modal-price" class="unbounded text-md text-orange-500 whitespace-nowrap ml-2"></span>
            </div>
            <p id="modal-desc" class="text-gray-500 text-sm leading-snug"></p>
        </div>

        <button id="modal-add-btn" class="w-full py-4 bg-black text-white rounded-2xl font-black text-xs uppercase tracking-widest active:scale-95 transition flex-shrink-0">
            –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
        </button>
    </div>
</div>

<div class="cart-bar" id="cart-bar">
    <div id="min-sum-progress-container" class="progress-container">
        <div id="min-sum-progress-fill" class="progress-fill"></div>
    </div>
    <div class="flex justify-between items-center w-full">
        <div class="cart-info" onclick="openDrawer()" style="cursor: pointer;">
            <span id="txt-items-count" style="font-size: 10px; font-weight: 800; color: var(--text-dim);">0 –¢–û–í–ê–†–û–í</span><br>
            <b id="txt-total-price" style="color: var(--accent-red);">0.00 ‚Çº</b>
            <div id="min-sum-msg" class="min-sum-hint"></div>
        </div>
        <button class="checkout-btn" id="btn-checkout-main" onclick="openDrawer()">–û–§–û–†–ú–ò–¢–¨</button>
    </div>
</div>

<div id="cart-drawer">
    <div class="drawer-header flex justify-between items-center">
        <h2 class="unbounded text-lg" id="txt-cart-title">–ö–û–†–ó–ò–ù–ê</h2>
        <button onclick="closeDrawer()" class="bg-white w-10 h-10 rounded-full border border-[var(--border)] shadow-sm flex items-center justify-center">‚úï</button>
    </div>
    
    <div class="drawer-content no-scrollbar" id="drawer-scroll-area">
        <div id="drawer-items" class="space-y-2 py-2"></div>
        <div id="upsell-section" class="mt-8 mb-4">
            <h3 class="text-[10px] font-black text-gray-400 uppercase mb-4 px-1" id="txt-upsell-title">–ß–∞—Å—Ç–æ –∑–∞–∫–∞–∑—ã–≤–∞—é—Ç</h3>
            <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2" id="upsell-list"></div>
        </div>
        <div class="scroll-down-hint" id="txt-scroll-hint" style="display: flex;">
            üëá <span id="txt-scroll-msg">–ü–†–û–õ–ò–°–¢–ê–ô–¢–ï –î–õ–Ø –ó–ê–ü–û–õ–ù–ï–ù–ò–Ø –ê–î–†–ï–°–ê</span> üëá
        </div>
        <div class="mt-4 mb-4 p-5 bg-white rounded-3xl border border-[var(--border)] shadow-sm" id="delivery-form-section">
            <h3 class="unbounded text-[12px] text-orange-500 uppercase tracking-widest mb-4">üìç <span id="txt-form-title">–î–ê–ù–ù–´–ï –î–û–°–¢–ê–í–ö–ò</span></h3>
            <div class="form-group">
                <input type="text" class="modern" id="f-name" placeholder="–ò–º—è">
                <input type="tel" class="modern" id="f-phone" placeholder="+994 (__) ___-__-__" maxlength="19">
                <input type="text" class="modern" id="f-addr" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏">
                <textarea class="modern" id="f-comment" placeholder="–î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫ –∑–∞–∫–∞–∑—É..."></textarea>
            </div>
        </div>
    </div>

    <div class="drawer-footer">
        <div class="cash-only-badge" id="txt-cash-info">üíµ –û–ü–õ–ê–¢–ê –¢–û–õ–¨–ö–û –ù–ê–õ–ò–ß–ù–´–ú–ò</div>
        <div class="flex justify-between items-center mb-4 px-1">
            <span class="text-xs font-bold text-[var(--text-dim)]" id="txt-footer-total-label">–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï:</span>
            <span class="unbounded text-lg font-black text-[var(--accent-red)]" id="txt-footer-total-val">0.00 ‚Çº</span>
        </div>
        <button class="checkout-btn w-full !h-[60px] uppercase tracking-widest shadow-lg" id="confirm-btn" onclick="submitOrder()">–ü–û–î–¢–í–ï–†–î–ò–¢–¨</button>
    </div>
</div>

<script>
    const MIN_ORDER_SUM = 5.50;
    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;

    let products = [
        { id: '1', cat: 'burger', price: 14.5, icon: 'üçî', img: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=400', ru: {n: "–ì–æ–ª–¥ –ë—É—Ä–≥–µ—Ä", d: "–ú—è—Å–æ –ø—Ä–∞–π–º, —á–µ–¥–¥–µ—Ä, —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å–æ—É—Å"}, az: {n: "Gold Burqer", d: "Praym …ôt, √ßedder, x√ºsusi sous"} },
        { id: '2', cat: 'burger', price: 12.0, icon: 'üçî', img: 'https://images.unsplash.com/photo-1550547660-d9450f859349?w=400', ru: {n: "–ß–∏–∫–µ–Ω –õ—é–∫—Å", d: "–ö—É—Ä–∏—Ü–∞ –≥—Ä–∏–ª—å, —Å–≤–µ–∂–∏–µ –æ–≤–æ—â–∏"}, az: {n: "√áiken L√ºks", d: "Toyuq qril, t…ô–∑…ô t…ôr…ôv…ôzl…ôr"} },
        { id: '3', cat: 'pizza', price: 18.0, icon: 'üçï', img: 'https://images.unsplash.com/photo-1513104890138-7c749659a591?w=400', ru: {n: "–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞", d: "–ö–ª–∞—Å—Å–∏–∫–∞ —Å —Ç–æ–º–∞—Ç–∞–º–∏ –∏ –º–æ—Ü–∞—Ä–µ–ª–ª–æ–π"}, az: {n: "Marqarita", d: "Pomidor v…ô mosarella il…ô klassika"} },
        { id: '4', cat: 'pizza', price: 21.0, icon: 'üçï', img: 'https://images.unsplash.com/photo-1574126154517-d1e0d89ef734?w=400', ru: {n: "–ü–µ–ø–ø–µ—Ä–æ–Ω–∏", d: "–û—Å—Ç—Ä–∞—è —Å–∞–ª—è–º–∏, –º–Ω–æ–≥–æ —Å—ã—Ä–∞"}, az: {n: "Pepperoni", d: "Acƒ±lƒ± salyami, bol pendir"} },
        { id: '5', cat: 'sides', price: 5.5, icon: 'üçü', img: 'https://images.unsplash.com/photo-1573015613135-a419014b2c49?w=400', ru: {n: "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –§—Ä–∏", d: "–ö—Ä—É–ø–Ω–∞—è —Å–æ–ª—å, —Å–æ—É—Å"}, az: {n: "Kartof Fri", d: "ƒ∞ri duz, sous"} },
        { id: '6', cat: 'sides', price: 6.0, icon: 'üçó', img: 'https://images.unsplash.com/photo-1541581340-374c644bcd42?w=400', ru: {n: "–ù–∞–≥–≥–µ—Ç—Å—ã", d: "6 —à—Ç—É–∫, –ø–∞–Ω–∏—Ä–æ–≤–∫–∞"}, az: {n: "Naggetsl…ôr", d: "6 …ôd…ôd, suxarƒ±"} },
        { id: '7', cat: 'drinks', price: 2.5, icon: 'ü•§', img: 'https://images.unsplash.com/photo-1622483767028-3f66f32aef97?w=400', ru: {n: "Coca-Cola", d: "0.5–ª —Ö–æ–ª–æ–¥–Ω–∞—è"}, az: {n: "Coca-Cola", d: "0.5l soyuq"} },
        { id: '8', cat: 'drinks', price: 2.5, icon: 'ü•§', img: 'https://images.unsplash.com/photo-1625772299848-391b6a87d7b3?w=400', ru: {n: "Fanta", d: "0.5–ª —Ö–æ–ª–æ–¥–Ω–∞—è"}, az: {n: "Fanta", d: "0.5l soyuq"} },
        { id: '9', cat: 'burger', price: 16.0, icon: 'üçî', img: 'https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?w=400', ru: {n: "–î–∞–±–ª –ß–∏–∑", d: "–î–≤–æ–π–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞"}, az: {n: "Dabl √áiz", d: "ƒ∞kiqat kotlet"} },
        { id: '10', cat: 'pizza', price: 19.5, icon: 'üçï', img: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=400', ru: {n: "–ß–µ—Ç—ã—Ä–µ –°—ã—Ä–∞", d: "–ü–∞—Ä–º–µ–∑–∞–Ω, –î–æ—Ä –±–ª—é"}, az: {n: "D√∂rd Pendir", d: "Parmezan, Dor bl√º"} },
        { id: '11', cat: 'burger', price: 15.0, icon: 'üçî', img: 'https://images.unsplash.com/photo-1586190848861-99aa4a171e90?w=400', ru: {n: "BBQ –ë—É—Ä–≥–µ—Ä", d: "–ë–µ–∫–æ–Ω, —Å–æ—É—Å BBQ"}, az: {n: "BBQ Burqer", d: "Bikon, BBQ sousu"} },
        { id: '12', cat: 'burger', price: 13.5, icon: 'üçî', img: 'https://images.unsplash.com/photo-1521305916504-4a1121188589?w=400', ru: {n: "–•–∞–ª–∞–ø–µ–Ω—å–æ –ë—É—Ä–≥–µ—Ä", d: "–û—Å—Ç—Ä—ã–π –ø–µ—Ä—á–∏–∫"}, az: {n: "Xalapeno Burqer", d: "Acƒ± bib…ôr"} },
        { id: '13', cat: 'pizza', price: 22.0, icon: 'üçï', img: 'https://images.unsplash.com/photo-1593504049359-74330189a355?w=400', ru: {n: "–ì—Ä–∏–±–Ω–∞—è –ü–∏—Ü—Ü–∞", d: "–®–∞–º–ø–∏–Ω—å–æ–Ω—ã, —Å–æ—É—Å"}, az: {n: "G√∂b…ôl…ôkli Pizza", d: "≈ûampinyon, sous"} },
        { id: '14', cat: 'pizza', price: 20.0, icon: 'üçï', img: 'https://images.unsplash.com/photo-1565299585323-38d6b0865b47?w=400', ru: {n: "–ì–∞–≤–∞–π—Å–∫–∞—è", d: "–ê–Ω–∞–Ω–∞—Å—ã, –∫—É—Ä–∏—Ü–∞"}, az: {n: "Havay Pizzasƒ±", d: "Ananas, toyuq"} },
        { id: '15', cat: 'sides', price: 8.5, icon: 'üçó', img: 'https://images.unsplash.com/photo-1562967914-608f82629710?w=400', ru: {n: "–ö—Ä—ã–ª—ã—à–∫–∏", d: "–û—Å—Ç—Ä—ã–µ –±–∞—Ñ—Ñ–∞–ª–æ"}, az: {n: "Toyuq Qanadlarƒ±", d: "Acƒ±lƒ± baffalo"} },
        { id: '16', cat: 'sides', price: 4.0, icon: 'üßÖ', img: 'https://images.unsplash.com/photo-1630384066255-4427b59ba5a4?w=400', ru: {n: "–õ—É–∫–æ–≤—ã–µ –∫–æ–ª—å—Ü–∞", d: "–í —Ö—Ä—É—Å—Ç—è—â–µ–π –ø–∞–Ω–∏—Ä–æ–≤–∫–µ"}, az: {n: "Soƒüan halqalarƒ±", d: "Xƒ±rtƒ±ldayan suxarƒ±"} },
        { id: '17', cat: 'drinks', price: 3.5, icon: 'üçä', img: 'https://images.unsplash.com/photo-1513558161293-cdaf765ed2fd?w=400', ru: {n: "–ê–ø–µ–ª—å—Å–∏–Ω. —Å–æ–∫", d: "0.4–ª —Å–≤–µ–∂–µ–≤—ã–∂–∞—Ç—ã–π"}, az: {n: "Portaqal ≈üir…ôsi", d: "0.4l t…ô–∑…ô"} },
        { id: '18', cat: 'drinks', price: 2.0, icon: 'üíß', img: 'https://images.unsplash.com/photo-1544145945-f904253d0c71?w=400', ru: {n: "–í–æ–¥–∞", d: "–ë–µ–∑ –≥–∞–∑–∞ 0.5–ª"}, az: {n: "Su", d: "Qazsƒ±n 0.5l"} },
        { id: '19', cat: 'burger', price: 11.5, icon: 'üçî', img: 'https://images.unsplash.com/photo-1513185158878-8d8c182b013f?w=400', ru: {n: "–ú–∏–Ω–∏ –ë—É—Ä–≥–µ—Ä", d: "–î–ª—è –ª–µ–≥–∫–æ–≥–æ –ø–µ—Ä–µ–∫—É—Å–∞"}, az: {n: "Mini Burqer", d: "Y√ºng√ºl q…ôlyanaltƒ±"} },
        { id: '20', cat: 'pizza', price: 25.0, icon: 'üçï', img: 'https://images.unsplash.com/photo-1571407970349-bc81e7e96d47?w=400', ru: {n: "–ú—è—Å–Ω–∞—è –ü–∏—Ü—Ü–∞", d: "–ê—Å—Å–æ—Ä—Ç–∏ –∏–∑ 4 –≤–∏–¥–æ–≤ –º—è—Å–∞"}, az: {n: "∆ètli Pizza", d: "4 n√∂v …ô—Ç assorti"} }
    ];

    const ads = [
        { id: 'a1', img: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800' },
        { id: 'a2', img: 'https://images.unsplash.com/photo-1543353071-10c8ba85a904?w=800' }
    ];

    let cart = {}; let lang = 'ru'; let activeCat = 'all';
    let isClicking = false;

    const i18n = {
        ru: { items: "–¢–û–í–ê–†–û–í", cart: "–ö–û–†–ó–ò–ù–ê", confirm: "–ü–û–î–¢–í–ï–†–î–ò–¢–¨", checkout: "–û–§–û–†–ú–ò–¢–¨", addr: "–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏", name: "–ò–º—è", comment: "–î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫ –∑–∞–∫–∞–∑—É...", totalLabel: "–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï:", cash: "üíµ –û–ü–õ–ê–¢–ê –¢–û–õ–¨–ö–û –ù–ê–õ–ò–ß–ù–´–ú–ò", formTitle: "–î–ê–ù–ù–´–ï –î–û–°–¢–ê–í–ö–ò", more: "–î–æ–±–∞–≤—å—Ç–µ –µ—â–µ", upsell: "–ß–∞—Å—Ç–æ –∑–∞–∫–∞–∑—ã–≤–∞—é—Ç", scrollMsg: "–ü–†–û–õ–ò–°–¢–ê–ô–¢–ï –î–õ–Ø –ó–ê–ü–û–õ–ù–ï–ù–ò–Ø –ê–î–†–ï–°–ê", addBtn: "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" },
        az: { items: "M∆èHSUL", cart: "S∆èB∆èT", confirm: "T∆èSDƒ∞QL∆è", checkout: "Sƒ∞FARƒ∞≈û ET", addr: "√áatdƒ±rƒ±lma √ºnvanƒ±", name: "Ad", comment: "Sifari≈ü √º√ß√ºn …ôlav…ôl…ôr...", totalLabel: "C∆èMƒ∞ √ñD∆èNƒ∞≈û:", cash: "üíµ ANCAQ NAƒûD √ñD∆èNƒ∞≈û", formTitle: "√áATDIRILMA M∆èLUMATI", more: "∆èlav…ô edin", upsell: "Tez-tez sifari≈ü edilir", scrollMsg: "√úNVANI DOLDURMAQ √ú√á√úN A≈ûAƒûI ENƒ∞N", addBtn: "S…ôb…ôt…ô …ô–ª–∞–≤…ô et" }
    };

    function init() {
        renderCarousel(); renderCategories(); renderProducts(); setupPhoneMask(); updateLangUI(); 
        if(tg) { tg.ready(); tg.expand(); }
    }

    function renderCarousel() {
        const track = document.getElementById('carousel-track');
        track.innerHTML = ads.map((ad, i) => `<div class="carousel-slide ${i === 0 ? 'active' : ''}"><img src="${ad.img}" alt="–†–µ–∫–ª–∞–º–Ω—ã–π –±–∞–Ω–Ω–µ—Ä"></div>`).join('');
        let current = 0;
        setInterval(() => {
            const slides = document.querySelectorAll('.carousel-slide'); if(slides.length === 0) return;
            slides[current].classList.remove('active'); current = (current + 1) % slides.length; slides[current].classList.add('active');
        }, 4000);
    }

    function setupPhoneMask() {
        const phoneInput = document.getElementById('f-phone');
        
        const mask = (val) => {
            let x = val.replace(/\D/g, '');
            if (x.startsWith('994')) x = x.substring(3);
            
            let res = '+994';
            if (x.length > 0) res += ' (' + x.substring(0, 2);
            if (x.length > 2) res += ') ' + x.substring(2, 5);
            if (x.length > 5) res += '-' + x.substring(5, 7);
            if (x.length > 7) res += '-' + x.substring(7, 9);
            return res;
        };

        phoneInput.addEventListener('input', (e) => {
            let val = e.target.value;
            if (!val.startsWith('+994')) val = '+994' + val;
            e.target.value = mask(val);
        });

        phoneInput.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && phoneInput.value.length <= 4) {
                e.preventDefault();
            }
        });
        
        phoneInput.addEventListener('focus', () => {
            if (phoneInput.value === '') phoneInput.value = '+994';
        });
    }

    function renderCategories() {
        const cats = lang === 'ru' ? 
            { all: "üçΩÔ∏è –í—Å–µ", burger: "üçî –ë—É—Ä–≥–µ—Ä—ã", pizza: "üçï –ü–∏—Ü—Ü–∞", sides: "üçü –ó–∞–∫—É—Å–∫–∏", drinks: "ü•§ –ù–∞–ø–∏—Ç–∫–∏" } : 
            { all: "üçΩÔ∏è Hamƒ±sƒ±", burger: "üçî Burqer", pizza: "üçï Pizza", sides: "üçü Q…ôlyanaltƒ±", drinks: "ü•§ ƒ∞√ßkil…ôr" };
        document.getElementById('cat-scroll').innerHTML = Object.keys(cats).map(k => `
            <button id="btn-cat-${k}" class="cat-btn ${activeCat === k ? 'active' : ''}" onclick="setCat('${k}')">${cats[k]}</button>
        `).join('');
    }

    window.setCat = (k) => {
        activeCat = k; renderCategories(); renderProducts(); 
        if(tg) tg.HapticFeedback.selectionChanged();
    };

    function renderProducts() {
        const grid = document.getElementById('product-grid');
        const filtered = activeCat === 'all' ? products : products.filter(p => p.cat === activeCat);
        grid.innerHTML = filtered.map(p => {
            const count = cart[p.id] || 0;
            return `
            <div class="product-card" onclick="showProductDetails('${p.id}')">
                ${count > 0 ? `<div class="badge">${count}</div>` : ''}
                <img src="${p.img}" class="product-img" alt="${p[lang].n}">
                <h4 class="font-extrabold text-[12px] truncate uppercase">${p[lang].n}</h4>
                <div class="flex justify-between items-center mt-2">
                    <span class="font-black text-orange-500 text-xs">${p.price.toFixed(2)} ‚Çº</span>
                    <button onclick="handleAddToCart('${p.id}', event)" class="btn-icon add-btn">+</button>
                </div>
            </div>
        `}).join('');
    }

    window.showProductDetails = (id) => {
        const p = products.find(x => x.id === id);
        if(!p) return;
        const modal = document.getElementById('product-modal');
        document.getElementById('modal-img').src = p.img;
        document.getElementById('modal-title').innerText = p[lang].n;
        document.getElementById('modal-desc').innerText = p[lang].d;
        document.getElementById('modal-price').innerText = `${p.price.toFixed(2)} ‚Çº`;
        document.getElementById('modal-add-btn').innerText = i18n[lang].addBtn;
        
        document.getElementById('modal-add-btn').onclick = () => { 
            handleAddToCart(id, null); 
            closeProductModal(); 
        };

        modal.style.display = 'flex';
        setTimeout(() => {
            modal.querySelector('.modal-content').style.transform = 'translateY(0)';
        }, 10);
    };

    window.closeProductModal = () => {
        const modal = document.getElementById('product-modal');
        const content = modal.querySelector('.modal-content');
        content.style.transform = 'translateY(100%)';
        setTimeout(() => {
            modal.style.display = 'none';
        }, 300);
    };

    window.handleAddToCart = (id, event) => {
        if(event) { event.stopPropagation(); }
        if (isClicking) return;
        isClicking = true;
        setTimeout(() => isClicking = false, 150);

        if(event) { flyToCart(event); }
        
        cart[id] = (cart[id] || 0) + 1;
        
        updateCartUI(); 
        renderProducts(); 
        
        if(document.getElementById('cart-drawer').style.display === 'flex') {
            renderDrawerItems();
            renderUpsell();
        }
        
        if(tg) tg.HapticFeedback.impactOccurred('medium');
    };

    function flyToCart(e) {
        if (!e) return;
        const fly = document.createElement('div');
        fly.className = 'fly-item'; fly.innerHTML = '‚ú®';
        fly.style.left = e.clientX + 'px'; fly.style.top = e.clientY + 'px';
        document.body.appendChild(fly);
        const target = document.getElementById('cart-bar').getBoundingClientRect();
        setTimeout(() => {
            fly.style.left = (target.left + target.width / 2) + 'px';
            fly.style.top = target.top + 'px';
            fly.style.transform = 'scale(0.1) rotate(360deg)'; fly.style.opacity = '0';
        }, 50);
        setTimeout(() => fly.remove(), 600);
    }

    function calculateTotal() {
        return Object.keys(cart).reduce((acc, id) => {
            const p = products.find(prod => prod.id === id);
            return p ? acc + (p.price * cart[id]) : acc;
        }, 0);
    }

    function updateCartUI() {
        const items = Object.values(cart).reduce((a, b) => a + b, 0);
        const total = calculateTotal();
        const bar = document.getElementById('cart-bar');
        
        if(items > 0) {
            bar.classList.add('active');
            document.getElementById('txt-items-count').innerText = `${items} ${i18n[lang].items}`;
            document.getElementById('txt-total-price').innerText = `${total.toFixed(2)} ‚Çº`;
            
            const percent = Math.min((total / MIN_ORDER_SUM) * 100, 100);
            document.getElementById('min-sum-progress-fill').style.width = percent + '%';
            
            const msg = document.getElementById('min-sum-msg');
            const btn = document.getElementById('btn-checkout-main');
            
            if(total < MIN_ORDER_SUM) {
                msg.innerText = `${i18n[lang].more} ${(MIN_ORDER_SUM - total).toFixed(2)} ‚Çº`;
                btn.disabled = true;
            } else { 
                msg.innerText = ''; 
                btn.disabled = false; 
            }
        } else { 
            bar.classList.remove('active'); 
        }
    }

    window.openDrawer = () => {
        document.getElementById('cart-drawer').style.display = 'flex';
        renderDrawerItems(); 
        renderUpsell(); 
        updateLangUI();
        document.getElementById('drawer-scroll-area').scrollTop = 0;
    };

    window.closeDrawer = () => { document.getElementById('cart-drawer').style.display = 'none'; };

    function renderDrawerItems() {
        const container = document.getElementById('drawer-items');
        const cartIds = Object.keys(cart);
        
        if (cartIds.length === 0) {
            container.innerHTML = `<p class="text-center text-gray-400 py-10">S…ôb…ôt bo≈üdur</p>`;
            return;
        }

        container.innerHTML = cartIds.map(id => {
            const p = products.find(x => x.id === id);
            if(!p) return '';
            return `
                <div class="flex items-center gap-4 bg-white p-3 rounded-2xl border border-[var(--border)]">
                    <img src="${p.img}" class="w-14 h-14 rounded-xl object-cover">
                    <div class="flex-grow">
                        <h4 class="font-bold text-[13px] uppercase">${p[lang].n}</h4>
                        <span class="text-xs text-orange-500 font-black">${p.price.toFixed(2)} ‚Çº</span>
                    </div>
                    <div class="flex items-center gap-3 bg-gray-50 p-1 rounded-xl">
                        <button onclick="updateQty('${id}', -1)" class="w-8 h-8 font-bold">-</button>
                        <span class="text-xs font-black">${cart[id]}</span>
                        <button onclick="updateQty('${id}', 1)" class="w-8 h-8 font-bold">+</button>
                    </div>
                </div>
            `;
        }).join('');
        
        const total = calculateTotal();
        document.getElementById('txt-footer-total-val').innerText = `${total.toFixed(2)} ‚Çº`;
        document.getElementById('confirm-btn').disabled = total < MIN_ORDER_SUM;
    }

    function renderUpsell() {
        const drinks = products.filter(p => p.cat === 'drinks' && !cart[p.id]);
        const list = document.getElementById('upsell-list');
        if (drinks.length === 0) {
            document.getElementById('upsell-section').style.display = 'none';
            return;
        }
        document.getElementById('upsell-section').style.display = 'block';
        list.innerHTML = drinks.map(p => `
            <div class="upsell-card" onclick="handleAddToCart('${p.id}', event)">
                <img src="${p.img}" class="w-12 h-12 mx-auto rounded-full object-cover mb-2 shadow-sm">
                <p class="text-[9px] font-bold truncate">${p[lang].n}</p>
                <p class="text-[10px] text-orange-500 font-black">+${p.price.toFixed(2)} ‚Çº</p>
            </div>
        `).join('');
    }

    window.updateQty = (id, delta) => {
        if(!cart[id]) return;
        cart[id] += delta; 
        if(cart[id] <= 0) delete cart[id];
        updateCartUI(); renderDrawerItems(); renderProducts(); renderUpsell();
        if(Object.keys(cart).length === 0) closeDrawer();
        if(tg) tg.HapticFeedback.impactOccurred('light');
    };

    window.changeLang = (l) => {
        lang = l; renderCategories(); renderProducts(); updateLangUI(); updateCartUI();
        if(document.getElementById('cart-drawer').style.display === 'flex') {
            renderDrawerItems(); renderUpsell();
        }
    };

    function updateLangUI() {
        document.getElementById('lang-ru').classList.toggle('active', lang === 'ru');
        document.getElementById('lang-az').classList.toggle('active', lang === 'az');
        document.getElementById('txt-cart-title').innerText = i18n[lang].cart;
        document.getElementById('confirm-btn').innerText = i18n[lang].confirm;
        document.getElementById('btn-checkout-main').innerText = i18n[lang].checkout;
        document.getElementById('f-name').placeholder = i18n[lang].name;
        document.getElementById('f-addr').placeholder = i18n[lang].addr;
        document.getElementById('f-comment').placeholder = i18n[lang].comment;
        document.getElementById('txt-footer-total-label').innerText = i18n[lang].totalLabel;
        document.getElementById('txt-cash-info').innerText = i18n[lang].cash;
        document.getElementById('txt-form-title').innerText = i18n[lang].formTitle;
        document.getElementById('txt-upsell-title').innerText = i18n[lang].upsell;
        document.getElementById('txt-scroll-msg').innerText = i18n[lang].scrollMsg;
    }

    // –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê –û–¢–ü–†–ê–í–ö–ò –î–ê–ù–ù–´–• –í –ë–û–¢–ê
    window.submitOrder = () => {
        const n = document.getElementById('f-name');
        const p = document.getElementById('f-phone');
        const a = document.getElementById('f-addr');
        
        let hasError = false;
        if(!n.value) { n.classList.add('highlight'); hasError = true; }
        if(p.value.length < 19) { p.classList.add('highlight'); hasError = true; }
        if(!a.value) { a.classList.add('highlight'); hasError = true; }

        if(hasError) {
            document.getElementById('delivery-form-section').scrollIntoView({ behavior: 'smooth' });
            setTimeout(() => { [n, p, a].forEach(i => i.classList.remove('highlight')); }, 2000);
            if(tg) tg.HapticFeedback.notificationOccurred('error'); 
            return;
        }

        const cartItems = Object.keys(cart).map(id => {
            const prod = products.find(x => x.id === id);
            return {
                name: prod[lang].n,
                qty: cart[id],
                price: prod.price,
                total: (prod.price * cart[id]).toFixed(2)
            };
        });

        const orderData = {
            customer: {
                name: n.value,
                phone: p.value,
                address: a.value,
                comment: document.getElementById('f-comment').value
            },
            items: cartItems,
            totalPrice: calculateTotal().toFixed(2) + ' ‚Çº',
            language: lang
        };

        if(tg) {
            tg.sendData(JSON.stringify(orderData));
            tg.HapticFeedback.notificationOccurred('success');
            tg.close();
        } else {
            console.log("Order Data:", orderData);
            alert("Order sent! (Debug mode)");
        }
    };
</script>
</body>
</html>

